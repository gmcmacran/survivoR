<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>readme</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="README_files/libs/clipboard/clipboard.min.js"></script>
<script src="README_files/libs/quarto-html/quarto.js"></script>
<script src="README_files/libs/quarto-html/popper.min.js"></script>
<script src="README_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="README_files/libs/quarto-html/anchor.min.js"></script>
<link href="README_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="README_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="README_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="README_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="README_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="repo-overview" class="level2">
<h2 class="anchored" data-anchor-id="repo-overview">Repo Overview</h2>
<p>This repo explores two classic statistical models for survival analysis using patients who experienced myocardial infarctions.</p>
<p>Models:</p>
<ul>
<li>Kaplan-Meier</li>
<li>Cox Proportional Hazards</li>
</ul>
</section>
<section id="censoring" class="level2">
<h2 class="anchored" data-anchor-id="censoring">Censoring</h2>
<p>Right censoring occurs when the event of interest is yet to be observed for some data. Examples include time to death for patients with a terminal illness, time to relapse for patients in rehab, or time to service termination for customers. Here are three hypothetical data points.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
   Time Event
  &lt;dbl&gt; &lt;dbl&gt;
1     1     0
2     2     1
3     3     1</code></pre>
</div>
</div>
<p>The average of time is not two. Due to the first observation being censored, the average is <strong>at least</strong> two. Unless all data points are uncensored, this “at least” affects all summary statistics, hypothesis tests, and models. Survival analysis is the area of statistics designed to deal with this notion of “at least” inherent in the data.</p>
</section>
<section id="data-overview" class="level2">
<h2 class="anchored" data-anchor-id="data-overview">Data Overview</h2>
<p>The data set includes 500 patients who suffered a heart attack.</p>
<p>Variables:</p>
<ul>
<li>id - Identification Code (1 - 500)</li>
<li>age - Age at Hospital Admission (years)</li>
<li>gender - Gender (0 = Male, 1 = Female)</li>
<li>hr - Initial Heart Rate (Beats per minute)</li>
<li>sysbp - Initial Systolic Blood Pressure (mmHg)</li>
<li>diasbp - Initial Diastolic Blood (mmHg)</li>
<li>bmi - Body Mass Index (kg/m^2)</li>
<li>cvd - History of Cardiovascular Disease (0 = No, 1 = Yes)</li>
<li>afb - Atrial Fibrillation (0 = No, 1 = Yes)</li>
<li>sho - Cardiogenic Shock (0 = No, 1 = Yes)</li>
<li>chf - Congestive Heart Complications (0 = No, 1 = Yes)</li>
<li>av3 - Complete Heart Block (0 = No, 1 = Yes)</li>
<li>miord - MI Order (0 = First, 1 = Recurrent)</li>
<li>mitype - MI Type (0 = non Q-wave, 1 = Q-wave)</li>
<li>year - Cohort Year</li>
<li>admitdate - Hospital Admission Date</li>
<li>disdate - Hospital Discharge Date</li>
<li>fdate - Date of last Follow Up</li>
<li>los - Length of Hospital Stay</li>
<li>dstat - Discharge Status from Hospital (0 = Alive, 1 = Dead)</li>
<li>lenfol - Total Length of Follow-up</li>
<li>fstat - Vital Status at Last Follow-up (0 = Alive 1 = Dead)</li>
</ul>
<p>The first ten rows look like</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 500 × 22
      id   age gender    hr sysbp diasbp   bmi   cvd   afb   sho   chf   av3
   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     1    83      0    89   152     78  25.5     1     1     0     0     0
 2     2    49      0    84   120     60  24.0     1     0     0     0     0
 3     3    70      1    83   147     88  22.1     0     0     0     0     0
 4     4    70      0    65   123     76  26.6     1     0     0     1     0
 5     5    70      0    63   135     85  24.4     1     0     0     0     0
 6     6    70      0    76    83     54  23.2     1     0     0     0     1
 7     7    57      0    73   191    116  39.5     1     0     0     0     0
 8     8    55      0    91   147     95  27.1     1     0     0     0     0
 9     9    88      1    63   209    100  27.4     1     0     0     1     0
10    10    54      0   104   166    106  25.5     1     0     0     0     0
# ℹ 490 more rows
# ℹ 10 more variables: miord &lt;dbl&gt;, mitype &lt;dbl&gt;, year &lt;dbl&gt;, admitdata &lt;chr&gt;,
#   disdate &lt;chr&gt;, fdate &lt;chr&gt;, los &lt;dbl&gt;, dstat &lt;dbl&gt;, lenfol &lt;dbl&gt;,
#   fstat &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="kaplan-meier-model" class="level2">
<h2 class="anchored" data-anchor-id="kaplan-meier-model">Kaplan-Meier Model</h2>
<p>The Kaplan-Meier model is a non-parametric model. This model makes no distributional assumptions about survival time. The main output is a survival curve.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="README_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>According to the curve, an estimated 70% of patients live at least 1.25 years after being admitted to the hospital for a myocardial infarction.</p>
<p>The KM approach can be used to compare different groups. Are congestive heart complications associated with worse survival? Visually, the green survival curve is much lower than the red survival curve indicating patients with complications die sooner than patients without.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="README_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Could this difference in survival be attributed to random chance alone? The log rank test shows a p-value below 5% indicating no. Complications are associated with worse survival.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = Surv(lenfol, fstat) ~ afb, data = whas500_02)

        N Observed Expected (O-E)^2/E (O-E)^2/V
afb=0 422      168    184.8      1.52      10.9
afb=1  78       47     30.2      9.31      10.9

 Chisq= 10.9  on 1 degrees of freedom, p= 0.001 </code></pre>
</div>
</div>
<p>The Kaplan-Meier model can be used as a descriptive tool or a inference tool. For inference, all other factors are ignored. This possible issue is addressed by the next model.</p>
</section>
<section id="cox-proportional-hazards-model" class="level1">
<h1>Cox Proportional Hazards Model</h1>
<p>The Cox Proportional Hazards model is an inference tool that controls other variables that possibly influence survival time. It does this my assuming a semi-parametric relationship between the hazard function and explanatory variables. With this model, a survival curve can be calculated.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="README_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>According to this model, an estimated 70% of patients live at least 3.25 years after being admitted.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>              coef exp(coef)    se(coef)         z     Pr(&gt;|z|)
age     0.05723802 1.0589078 0.006417813  8.918617 4.721482e-19
chf     0.84655007 2.3315891 0.144915759  5.841670 5.168004e-09
sho     1.05101250 2.8605460 0.267750715  3.925340 8.660745e-05
gender -0.18200553 0.8335967 0.141142629 -1.289515 1.972191e-01
mitype -0.41349385 0.6613356 0.178263485 -2.319566 2.036439e-02</code></pre>
</div>
</div>
<p>According to the model (and ignoring the inflated type I error rate), risk of death increases with:</p>
<ul>
<li>Increases in age</li>
<li>Congestive heart complications</li>
<li>Cardiogenic shock</li>
</ul>
<p>Risk of death decreases with:</p>
<ul>
<li>Being male</li>
<li>Having a Q-wave heart attack instead of a non Q wave.</li>
</ul>
<p>Note Q-wave itself may not be protective. It is possible Q-wave heart attacks are easier to identify leading to earlier patient escalation and therefore better survival.</p>
</section>
<section id="survival-curve-comparison" class="level1">
<h1>Survival Curve Comparison</h1>
<p>The two models lead to meaningfully different survival curves. This is due to the difference in model assumptions. Under the hood, the Proportional Hazards model uses the Nelson-Aalen estimator of survival instead of the Kaplan-Meier estimator.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="README_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The K.M. estimator will never be greater than the N.A. estimator. Depending on observed data, it is possible the two estimators are functionally equal.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>